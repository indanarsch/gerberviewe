#!/usr/bin/env node
//utility for initialising a manifest.json file for a test boards folder

const wtg = require('whats-that-gerber')
const glob = require('glob')
const path = require('path')

const folderPath = process.argv[2]

if (typeof folderPath !== 'string') {
  console.error('USAGE: ./init-manifest folder > folder/manifest.json')
  process.exit(1)
}

const globPath = path.join(folderPath, '/**/*')
const files = glob.sync(globPath).filter(f => {
  return !/LICENSE$/.test(f) && !/manifest.json$/.test(f)
})

const layers = files.map(f => {
  const name = path.relative(folderPath, f)
  const type = wtg(name)
  const format = type === 'drl' ? 'drill' : 'gerber'
  return {name, type, format}
})

const manifest = {skipSnapshot: false, layers}

console.log(JSON.stringify(manifest, null, 2))
